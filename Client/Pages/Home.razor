@using System.Timers;
@using BlazorApp.Client.Components.BootstrapCarousel
@using BlazorApp.Shared
@using static BlazorApp.Shared.Assets
@page "/"
@inject ILocalStorageService _localstorage
@inject IJSRuntime js

<PageTitle>Eat my entire ass</PageTitle>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <h1>
            <a class="navbar-brand" href="#">
                <img class="img-fluid" src="/icon-192.png" width="25" />
                EMEA
            </a>
        </h1>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav justify-content-end gap-3 w-100">
                <Tooltip Title="What the hell is this?" Placement="TooltipPlacement.Auto">
                    <Button Color="ButtonColor.Light" Outline="true" Class="rounded-circle px-3" @onclick="ShowHelpDialog">
                        ?
                    </Button>
                </Tooltip>

                <Tooltip Title="Who is responsible for this?" Placement="TooltipPlacement.Auto">
                    <Button Color="ButtonColor.Light" Outline="true" Class="rounded-circle" @onclick="ShowAboutDialog">
                        <i class="fas fa-user"></i>
                    </Button>
                </Tooltip>

                <Tooltip Title="Options" Placement="TooltipPlacement.Auto">
                    <Button Color="ButtonColor.Light" Outline="true" Class="rounded-circle" @onclick="ShowOptionsDialog">
                        <i class="fas fa-gear"></i>
                    </Button>
                </Tooltip>
            </div>
        </div>
    </div>
</nav>

<div class="vstack justify-content-center align-content-center text-center py-5 my-5" @onclick="EatPiece">
        <p class="display-4 fw-light text-center">
            Eat my entire ass!
        </p>
        <p class="display-1 mb-0">
            @TimerDisplay
        </p>
        <p class="fs-6">
            @if(piecesEaten < AssFrames.Count()-2)
            {
                @: (click to <strong>eat</strong> ass)
            }
            else
            {
                @: (click to <strong>finish</strong> ass)
            }
            <br/>
            <img class="img-fluid" src="/images/Asses/@CurrentAssType.ToString()/@AssFrames[piecesEaten]" width="600" />
        </p>
    </div>


<Modal @ref="HelpDialog" IsVerticallyCentered="true" HeaderCssClass="bg-body-secondary text-body">
    <HeaderTemplate>
        <h5 class="modal-title text-peach">
            <span class="fa-layers fa-fw me-3">
                <i class="fas fa-circle" data-fa-transform="left-3"></i>
                <i class="fas fa-circle" data-fa-transform="right-3"></i>
                <i class="fas fa-circle text-dark" data-fa-transform="shrink-12"></i>
            </span>
            Butt why?
        </h5>
    </HeaderTemplate>
    <BodyTemplate>
        <ul>
            <li>
                You have 1 minute to eat as much ass as you can.
            </li> 
            <li>
                Your score is based on how many whole asses you consume. Unfinished portions do not count.
            </li>
            <li>
                Certain asses are worth more points than others.
            </li>
        </ul>
        <p class="my-3 fw-bold">
            There are NO half points. Fractions are for pussies, we only deal in whole numbers.
        </p>
        <p>
            There are @Enum.GetValues(typeof(AssTypeEnum)).Length different kinds of asses.
        </p>
        <BootstrapCarousel Items="CarouselItems" ShowIndicators="false" Id="AssCarousel">
            <ItemTemplate>
                <div class="hstack gap-3">
                    <img src="@context.ImageUrl" 
                         class="d-block w-50" 
                         alt="@context.AltText" />
                    <div class="text-light">
                        <h5>@context.Title</h5>
                        <p>@context.Description</p>
                    </div>
                </div>
            </ItemTemplate>
        </BootstrapCarousel>
        <div class="hstack justify-content-end">
            <Button Color="ButtonColor.Primary" @onclick="HideHelpDialog">
                Ok! <i class="fas fa-face-grin-wide ms-3"></i>
            </Button>
        </div>
    </BodyTemplate>
</Modal>

<Modal @ref="AboutDialog" IsVerticallyCentered="true" HeaderCssClass="bg-body-secondary text-body">
    <HeaderTemplate>
        <h5 class="modal-title">
            <i class="fas fa-user"></i>
            Who's responsible for this?
        </h5>
    </HeaderTemplate>
    <BodyTemplate>
        Some dude behind a keyboard with way too much time on his hands.
        <div class="hstack justify-content-end">
            <Button Color="ButtonColor.Primary" @onclick="HideAboutDialog">
                Makes Sense <i class="fas fa-check ms-3"></i>
            </Button>
        </div>
    </BodyTemplate>
</Modal>

<Modal @ref="ResultsDialog" IsVerticallyCentered="true" HeaderCssClass="bg-primary text-white">
    <HeaderTemplate>
        <h5 class="modal-title">
            <i class="fas fa-flag-checkered"></i>
            Results: @Math.Truncate(assesEaten) ass(es)
        </h5>
    </HeaderTemplate>
    <BodyTemplate>
        <p class="display-1 text-center fw-bold">
            @Math.Truncate(assesEaten)
        </p>
        <p class="lead text-center">
            @scoreText
        </p>

        <p>Breakdown:</p>
        <div class="row">
            @foreach(var ass in AssTypes){
                <div class="col">
                    <p class="text-center">
                        <img src="/images/Asses/@ass.ToString()/entire_ass.png" width="50" />
                        <br />
                        <span class="fw-bold">
                            @Breakdown[ass]
                        </span>
                    </p>
                </div>
            }
        </div>
        <div class="hstack justify-content-end">
            <Button Color="ButtonColor.Primary" @onclick="TryAgain">
                Try again <i class="fas fa-rotate ms-3"></i>
            </Button>
        </div>
    </BodyTemplate>
</Modal>

<Modal @ref="OptionsDialog" IsVerticallyCentered="true" HeaderCssClass="bg-body-secondary text-body">
    <HeaderTemplate>
        <h5 class="modal-title">
            <i class="fas fa-gear"></i>
            Settings
        </h5>
    </HeaderTemplate>
    <BodyTemplate>
        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="playSoundsCheck" @bind="playSounds">
            <label class="form-check-label" for="playSoundsCheck">
                <i class="@(playSounds ? "fas fa-volume-up" : "fas fa-volume-mute")"></i>
                Play Sounds
            </label>
        </div>
        <div class="mb-3">
            <label for="volumeSlider" class="form-label">
                <i class="fas fa-volume-down"></i> Volume: @volume.ToString("0.0")
            </label>
            <input type="range" class="form-range" id="volumeSlider" min="0" max="1" step="0.1" @bind="volume">
        </div>
    </BodyTemplate>
</Modal>